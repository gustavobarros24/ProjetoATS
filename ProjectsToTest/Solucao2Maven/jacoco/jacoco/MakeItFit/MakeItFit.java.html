<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MakeItFit.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Solucao2</a> &gt; <a href="index.source.html" class="el_package">MakeItFit</a> &gt; <span class="el_source">MakeItFit.java</span></div><h1>MakeItFit.java</h1><pre class="source lang-java linenums">package MakeItFit;

import MakeItFit.activities.Activity;
import MakeItFit.exceptions.*;
import MakeItFit.trainingPlan.*;
import MakeItFit.users.*;
import MakeItFit.utils.MakeItFitDate;

import MakeItFit.queries.*;

import java.io.*;
import java.util.List;
import java.util.UUID;

/**
 * The class MakeItFit represents the model of the application.
 *
 * @author  Afonso Santos (a104276), HÃ©lder Gomes (a104100) and Pedro Pereira (a104082)
 * @version (11052024)
 */
public class MakeItFit implements Serializable {

    private UserManager userManager;
    private TrainingPlanManager trainingPlanManager;
    private QueriesManager queriesManager;

<span class="nc" id="L27">    public MakeItFit() {</span>
<span class="nc" id="L28">        this.userManager = new UserManager();</span>
<span class="nc" id="L29">        this.trainingPlanManager = new TrainingPlanManager();</span>
<span class="nc" id="L30">        this.queriesManager = new QueriesManager(userManager , trainingPlanManager);</span>
<span class="nc" id="L31">    }</span>

    /**
     * Creates a new user with the provided details.
     *
     * @param name The user's name.
     * @param age The user's age.
     * @param gender The user's gender.
     * @param weight The user's weight.
     * @param height The user's height.
     * @param bpm The user's heart rate in beats per minute.
     * @param level The user's experience level.
     * @param address The user's address.
     * @param phone The user's phone number.
     * @param email The user's email address.
     * @param frequency The user's training frequency.
     * @param type The user's type.
     * @throws IllegalArgumentException If any of the provided arguments are invalid.
     * @throws ExistingEntityConflictException If a user with the same email already exists.
     * @throws InvalidTypeException If an invalid type is encountered during user creation.
     */
    public void createUser(String name, int age, Gender gender, float weight, int height, int bpm, int level, String address, String phone, String email, int frequency, String type) throws IllegalArgumentException, ExistingEntityConflictException, InvalidTypeException {
<span class="nc" id="L53">        User user = this.userManager.createUser(name, age, gender, weight, height, bpm, level, address, phone, email, frequency, type);</span>
<span class="nc" id="L54">        this.userManager.insertUser(user);</span>
<span class="nc" id="L55">    }</span>

    /**
     * Removes a user based on the provided identifier.
     *
     * @param identifier The user's identifier, either a UUID or email.
     * @throws EntityDoesNotExistException If the user does not exist.
     * @throws InvalidTypeException If the identifier type is neither UUID nor String.
     */
    public void removeUser(Object identifier) throws EntityDoesNotExistException {
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (identifier instanceof UUID) {</span>
<span class="nc" id="L66">            this.userManager.removeUserByCode((UUID) identifier);</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">        } else if (identifier instanceof String) {</span>
<span class="nc" id="L68">            this.userManager.removeUserByEmail((String) identifier);</span>
        } else {
<span class="nc" id="L70">            throw new InvalidTypeException();</span>
        }
<span class="nc" id="L72">    }</span>

    /**
     * Checks whether a user with the specified email exists.
     *
     * @param email The user's email address.
     * @return `true` if a user with the email exists, `false` otherwise.
     */
    public boolean existsUserWithEmail(String email) {
<span class="nc" id="L81">        return this.userManager.existsUserWithEmail(email);</span>
    }

    /**
     * Retrieves a user based on the provided identifier.
     *
     * @param identifier The user's identifier, either a UUID or email.
     * @return The retrieved user.
     * @throws InvalidTypeException If the identifier type is neither UUID nor String.
     */
    public User getUser(Object identifier) throws InvalidTypeException {
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (identifier instanceof UUID) {</span>
<span class="nc" id="L93">            return this.userManager.getUserByCode((UUID) identifier);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        } else if (identifier instanceof String) {</span>
<span class="nc" id="L95">            return this.userManager.getUserByEmail((String) identifier);</span>
        } else {
<span class="nc" id="L97">            throw new InvalidTypeException();</span>
        }
    }

    /**
     * Updates the user's name.
     *
     * @param name The new name for the user.
     * @param email The user's email.
     */
    public void updateUserName(String name, String email) {
<span class="nc" id="L108">        User user = getUser(email);</span>
<span class="nc" id="L109">        user.setName(name);</span>
<span class="nc" id="L110">        this.userManager.updateUser(user);</span>
<span class="nc" id="L111">    }</span>

    /**
     * Updates the user's age.
     *
     * @param age The new age for the user.
     * @param email The user's email.
     */
    public void updateUserAge(int age, String email) {
<span class="nc" id="L120">        User user = getUser(email);</span>
<span class="nc" id="L121">        user.setAge(age);</span>
<span class="nc" id="L122">        this.userManager.updateUser(user);</span>
<span class="nc" id="L123">    }</span>

    /**
     * Updates the user's gender.
     * 
     * @param gender The new gender for the user.
     * @param email The user's email.
     */
    public void updateUserGender(Gender gender, String email) {
<span class="nc" id="L132">        User user = getUser(email);</span>
<span class="nc" id="L133">        user.setGender(gender);</span>
<span class="nc" id="L134">        this.userManager.updateUser(user);</span>
<span class="nc" id="L135">    }</span>

    /**
     * Updates the user's weight.
     *
     * @param weight The new weight for the user.
     * @param email The user's email.
     */
    public void updateUserWeight(float weight, String email) {
<span class="nc" id="L144">        User user = getUser(email);</span>
<span class="nc" id="L145">        user.setWeight(weight);</span>
<span class="nc" id="L146">        this.userManager.updateUser(user);</span>
<span class="nc" id="L147">    }</span>

    /**
     * Updates the user's height.
     *
     * @param height The new height for the user.
     * @param email The user's email.
     */
    public void updateUserHeight(int height, String email) {
<span class="nc" id="L156">        User user = getUser(email);</span>
<span class="nc" id="L157">        user.setHeight(height);</span>
<span class="nc" id="L158">        this.userManager.updateUser(user);</span>
<span class="nc" id="L159">    }</span>

    /**
     * Updates the user's heart rate in beats per minute (BPM).
     *
     * @param bpm The new BPM for the user.
     * @param email The user's email.
     */
    public void updateUserBpm(int bpm, String email) {
<span class="nc" id="L168">        User user = getUser(email);</span>
<span class="nc" id="L169">        user.setBpm(bpm);</span>
<span class="nc" id="L170">        this.userManager.updateUser(user);</span>
<span class="nc" id="L171">    }</span>

    /**
     * Updates the user's experience level.
     *
     * @param level The new experience level for the user.
     * @param email The user's email.
     */
    public void updateUserLevel(int level, String email) {
<span class="nc" id="L180">        User user = getUser(email);</span>
<span class="nc" id="L181">        user.setLevel(level);</span>
<span class="nc" id="L182">        this.userManager.updateUser(user);</span>
<span class="nc" id="L183">    }</span>

    /**
     * Updates the user's address.
     *
     * @param address The new address for the user.
     * @param email The user's email.
     */
    public void updateUserAddress(String address, String email) {
<span class="nc" id="L192">        User user = getUser(email);</span>
<span class="nc" id="L193">        user.setAddress(address);</span>
<span class="nc" id="L194">        this.userManager.updateUser(user);</span>
<span class="nc" id="L195">    }</span>

    /**
     * Updates the user's phone number.
     *
     * @param phone The new phone number for the user.
     * @param email The user's email.
     */
    public void updateUserPhone(String phone, String email) {
<span class="nc" id="L204">        User user = getUser(email);</span>
<span class="nc" id="L205">        user.setPhone(phone);</span>
<span class="nc" id="L206">        this.userManager.updateUser(user);</span>
<span class="nc" id="L207">    }</span>

    /**
     * Updates the user's email address.
     *
     * @param email The new email address for the user.
     * @param email The user's email.
     */
    public void updateUserEmail(String email, String newEmail) {
<span class="nc" id="L216">        User user = getUser(email);</span>
<span class="nc" id="L217">        user.setEmail(newEmail);</span>
<span class="nc" id="L218">        this.userManager.updateUser(user);</span>
<span class="nc" id="L219">    }</span>

    /**
     * Retrieves a list of all users.
     *
     * @return A list of all users.
     */
    public List&lt;User&gt; getAllUsers() {
<span class="nc" id="L227">        return this.userManager.getAllUsers();</span>
    }

    /**
     * Retrieves a list of all activities from a user.
     *
     * @param email The user's email address.
     * @return A list of all activities from the user.
     */
    public List&lt;Activity&gt; getActivitiesFromUser(String email) {
<span class="nc" id="L237">        return this.userManager.getActivitiesFromUser(email);</span>
    }

    /**
     * Adds an activity to a user.
     *
     * @param email The user's email.
     */
    public void addActivityToUser(String email, Activity activity) {
<span class="nc" id="L246">        this.userManager.addActivityToUser(email, activity);</span>
<span class="nc" id="L247">    }</span>

    /**
     * Removes an activity from a user.
     *
     * @param email The user's email.
     * @param code The activity's code.
     */
    public void removeActivityFromUser(String email, UUID code) {
<span class="nc" id="L256">        this.userManager.removeActivityFromUser(email, code);</span>
<span class="nc" id="L257">    }</span>

    /**
     * Creates a new training plan based on the provided specifications.
     *
     * @param userCode  The code of the user for whom the training plan will be created.
     * @param startDate The start date of the new training plan.
     * @return The code of the created training plan.
     * @throws IllegalArgumentException If the provided arguments are not valid.
     */
    public UUID createTrainingPlan(UUID userCode, MakeItFitDate startDate) throws IllegalArgumentException {
<span class="nc" id="L268">        TrainingPlan trainingPlan = this.trainingPlanManager.createTrainingPlan(userCode, startDate);</span>
<span class="nc" id="L269">        this.trainingPlanManager.insertTrainingPlan(trainingPlan);</span>
<span class="nc" id="L270">        return trainingPlan.getCode();</span>
    }

    /**
     * Creates a new training plan based on the provided objectives.
     *
     * @param trainingPlan The training plan in usage.
     * @param hardActivity Whether the activities should be hard.
     * @param maxActivitiesPerDay The maximum number of activities per day.
     * @param maxDifferentActivities The maximum number of different activities.
     * @param weeklyRecurrence The weekly recurrence of the activities.
     * @param minimumCaloricWaste The minimum caloric waste of the activities.
     * @throws IllegalArgumentException If the provided arguments are not valid.
     */
    public void constructTrainingPlanByObjectives(TrainingPlan trainingPlan, boolean hardActivity, int maxActivitiesPerDay, int maxDifferentActivities, int weeklyRecurrence, int minimumCaloricWaste) throws IllegalArgumentException {
<span class="nc" id="L285">        this.trainingPlanManager.constructTrainingPlanByObjectives(trainingPlan, this.userManager.getUserByCode(trainingPlan.getUserCode()).getIndex(), hardActivity, maxActivitiesPerDay, maxDifferentActivities, weeklyRecurrence, minimumCaloricWaste);</span>
<span class="nc" id="L286">    }</span>

    /**
     * Removes a training plan based on the provided code.
     *
     * @param code The code of the training plan to be removed.
     */
    public void removeTrainingPlan(UUID code) {
<span class="nc" id="L294">        this.trainingPlanManager.removeTrainingPlan(code);</span>
<span class="nc" id="L295">    }</span>

    /**
     * Retrieves a training plan based on the provided code.
     *
     * @param code The code of the training plan to be retrieved.
     * @throws IllegalArgumentException If the provided code is not valid.
     * @return The retrieved training plan.
     */
    public TrainingPlan getTrainingPlan(UUID code) throws IllegalArgumentException {
<span class="nc" id="L305">        return this.trainingPlanManager.getTrainingPlan(code);</span>
    }

    /**
     * Updates a training plan based on the provided details.
     *
     * @param trainingPlan The updated training plan.
     * @throws EntityDoesNotExistException If the training plan does not exist.
     */
    public void updateTrainingPlan(TrainingPlan trainingPlan) throws EntityDoesNotExistException {
<span class="nc" id="L315">        this.trainingPlanManager.updateTrainingPlan(trainingPlan);</span>
<span class="nc" id="L316">    }</span>

    /**
     * Returns a list of all existing training plans.
     *
     * @return A list of all training plans.
     */
    public List&lt;TrainingPlan&gt; getAllTrainingPlans() {
<span class="nc" id="L324">        return this.trainingPlanManager.getAllTrainingPlans();</span>
    }

    /**
     * Adds an activity to a training plan from a user.
     *
     * @param code The user's code.
     * @param activity The activity to be added.
     * @param iterations The iterations of the activity.
     */
    public void addActivityToTrainingPlan(UUID code, Activity activity, int iterations) {
<span class="nc" id="L335">        this.trainingPlanManager.addActivity(code, iterations, activity);</span>
<span class="nc" id="L336">    }</span>

    /**
     * Removes an activity from a training plan.
     *
     * @param code The code of the training plan.
     * @param activityCode The code of the activity.
     */
    public void removeActivityFromTrainingPlan(UUID code, UUID activityCode) {
<span class="nc" id="L345">        this.trainingPlanManager.removeActivity(code, activityCode);</span>
<span class="nc" id="L346">    }</span>

    /**
     * Retrieves a list of all training plans from a user.
     *
     * @param userCode The code of the user.
     * @return A list of all training plans from the user.
     */
    public List&lt;TrainingPlan&gt; getTrainingPlansFromUser(UUID userCode) {
<span class="nc" id="L355">        return this.trainingPlanManager.getTrainingPlansFromUser(userCode);</span>
    }

    /**
     * Updates the system current date.
     *
     * @param currentDate The current date of the system.
     */
    public void updateSystem(MakeItFitDate currentDate, UUID userCode){
<span class="nc" id="L364">        this.userManager.updateSystem();</span>
<span class="nc" id="L365">        this.trainingPlanManager.updateActivities(currentDate, userManager.getUserByCode(userCode).getIndex());</span>
<span class="nc" id="L366">        List&lt;Activity&gt; activities = this.trainingPlanManager.extractActivities(currentDate, userCode);</span>
<span class="nc" id="L367">        this.userManager.addActivitiesToUser(userCode, activities);</span>
<span class="nc" id="L368">    }</span>

    /**
     * Saves the system to a file.
     *
     * @param fileName The name of the file to save the system to.
     */
    public void saveSystem(String fileName) throws FileNotFoundException {
<span class="nc" id="L376">        try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(fileName))) {</span>
<span class="nc" id="L377">            oos.writeObject(this);</span>
<span class="nc" id="L378">        } catch (IOException e) {</span>
<span class="nc" id="L379">            System.out.println(&quot;MakeItFit.saveSystem: &quot; + e.getMessage());</span>
<span class="nc" id="L380">            throw new FileNotFoundException();</span>
<span class="nc" id="L381">        }</span>
<span class="nc" id="L382">    }</span>

    /**
     * Loads the system from a file.
     *
     * @param fileName The name of the file to load the system from.
     */
    public void loadSystem(String fileName) throws FileNotFoundException {
<span class="nc" id="L390">        try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(fileName))) {</span>
<span class="nc" id="L391">            MakeItFit makeItFit = (MakeItFit) ois.readObject();</span>
<span class="nc" id="L392">            this.userManager = makeItFit.userManager;</span>
<span class="nc" id="L393">            this.trainingPlanManager = makeItFit.trainingPlanManager;</span>
<span class="nc" id="L394">        } catch (IOException | ClassNotFoundException e) {</span>
<span class="nc" id="L395">            throw new FileNotFoundException();</span>
<span class="nc" id="L396">        }</span>
<span class="nc" id="L397">    }</span>

    /**
     * Executes a query and returns the result.
     * @param email The email of the user.
     * @param date1 If wanted, the start date of the period.
     * @param date2 If wanted, the end date of the period.
     * @return number of km the user did in a given period of time or in total
     */
    public double executeQueryHowManyKMsDone(String email, MakeItFitDate date1, MakeItFitDate date2) {
<span class="nc" id="L407">        return this.queriesManager.executeQueryHowManyKMsDone(this.userManager, email, date1, date2);</span>
    }

    /**
     * Executes a query and returns the result.
     * @param email The email of the user.
     * @return number of altimetry the user did in a given period of time or in total
     */
    public double executeQueryHowManyKMsDone(String email) {
<span class="nc" id="L416">        return this.queriesManager.executeQueryHowManyKMsDone(this.userManager, email);</span>
    }

    /**
     * Executes a query and returns the result.
     * @param email The email of the user.
     * @param date1 If wanted, the start date of the period.
     * @param date2 If wanted, the end date of the period.
     * @return number of altimetry the user did in a given period of time or in total
     */
    public double executeQueryHowManyAltimetryDone(String email, MakeItFitDate date1, MakeItFitDate date2) {
<span class="nc" id="L427">        return this.queriesManager.executeQueryHowManyAltimetryDone(this.userManager, email, date1, date2);</span>
    }

    /**
     * Executes a query and returns the result.
     * @param email The email of the user.
     * @return number of altimetry the user did in a given period of time or in total
     */
    public double executeQueryHowManyAltimetryDone(String email) {
<span class="nc" id="L436">        return this.queriesManager.executeQueryHowManyAltimetryDone(this.userManager, email);</span>
    }

    /**
     *  Executes a query and returns the result.
     * 
     * @return The most demanding training plan.
     */
    public TrainingPlan executeQueryMostDemandingTrainingPlan(){
<span class="nc" id="L445">        return this.queriesManager.executeQueryMostDemandingTrainingPlan(this.trainingPlanManager, this.userManager);</span>
    }

    /**
     * Executes a query and returns the result.
     * @return The most done activity.
     */
    public String executeQueryMostDoneActivity() {
<span class="nc" id="L453">        return this.queriesManager.executeQueryMostDoneActivity(this.userManager);</span>
    }

    /**
     * Executes a query and returns the result.
     * @param date1 If wanted, the start date of the period.
     * @param date2 If wanted, the end date of the period.
     * @return the user who burns more calories between two dates or in total
     */
    public User executeQuerywhoBurnsMoreCalories(MakeItFitDate date1, MakeItFitDate date2) {
<span class="nc" id="L463">        return this.queriesManager.executeQuerywhoBurnsMoreCalories(this.userManager, date1, date2);</span>
    }

    /**
     * Executes a query and returns the result.
     * @return the user who burns more calories
     */
    public User executeQuerywhoBurnsMoreCalories() {
<span class="nc" id="L471">        return this.queriesManager.executeQuerywhoBurnsMoreCalories(this.userManager);</span>
    }

    /**
     *  Executes a query and returns the result.
     * @param date1 If wanted, the start date of the period.
     * @param date2 If wanted, the end date of the period.
     * @return the user who did the most activities between two dates or in total
     */
    public User executeQueryWhoDidTheMostActivities(MakeItFitDate date1, MakeItFitDate date2) {
<span class="nc" id="L481">        return this.queriesManager.executeQueryWhoDidTheMostActivities(this.userManager, date1, date2);</span>
    }

    /**
     *  Executes a query and returns the result.
     * @return the user who did the most activities
     */
    public User executeQueryWhoDidTheMostActivities() {
<span class="nc" id="L489">        return this.queriesManager.executeQueryWhoDidTheMostActivities(this.userManager);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>